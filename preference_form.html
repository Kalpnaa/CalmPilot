<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit CalmPilot Preferences</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto; }
        h1 { color: #333; text-align: center; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="text"], select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[type="checkbox"] { margin-right: 5px; }
        .checkbox-group label { display: inline-block; margin-right: 15px; font-weight: normal; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background-color: #0056b3; }
        #responseMessage { margin-top: 20px; padding: 10px; border-radius: 4px; text-align: center; }
        .success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CalmPilot User Preferences</h1>
        <p>Please enter your user ID and preferences. This will update your profile for personalized suggestions.</p>
        <form id="preferencesForm">
            <div class="form-group">
                <label for="userId">User ID:</label>
                <input type="text" id="userId" name="user_id" required placeholder="e.g., user_c">
            </div>

            <h2>Meal Preferences</h2>
            <div class="form-group">
                <label for="mealType">Meal Preference Type:</label>
                <select id="mealType" name="meal_pref_type">
                    <option value="">Select type</option>
                    <option value="Vegetarian">Vegetarian</option>
                    <option value="Non-vegetarian">Non-vegetarian</option>
                    <option value="Vegan">Vegan</option>
                </select>
            </div>
            <div class="form-group">
                <label>Meal Preference Cuisine:</label><br>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="meal_pref_cuisine" value="Indian (North)"> Indian (North)</label>
                    <label><input type="checkbox" name="meal_pref_cuisine" value="Indian (South)"> Indian (South)</label>
                    <label><input type="checkbox" name="meal_pref_cuisine" value="Chinese / Oriental"> Chinese / Oriental</label>
                    <label><input type="checkbox" name="meal_pref_cuisine" value="Western / Continental"> Western / Continental</label>
                    <label><input type="checkbox" name="meal_pref_cuisine" value="Healthy / Salad focused"> Healthy / Salad focused</label>
                </div>
            </div>
            <div class="form-group">
                <label for="mealTime">Meal Preference Time Available:</label>
                <select id="mealTime" name="meal_pref_time_available">
                    <option value="">Select time</option>
                    <option value="Under 15 minutes (Very Quick)">Under 15 minutes (Very Quick)</option>
                    <option value="15-30 minutes (Medium Quick)">15-30 minutes (Medium Quick)</option>
                    <option value="30-60 minutes (Moderate Time)">30-60 minutes (Moderate Time)</option>
                    <option value="Over 60 minutes (Leisurely)">Over 60 minutes (Leisurely)</option>
                </select>
            </div>

            <h2>Task Preferences</h2>
            <div class="form-group">
                <label for="taskEffort">Task Preference Effort:</label>
                <select id="taskEffort" name="task_pref_effort">
                    <option value="">Select effort</option>
                    <option value="Low Effort (e.g., replying to a short email)">Low Effort (e.g., replying to a short email)</option>
                    <option value="Medium Effort (e.g., organizing a small folder)">Medium Effort (e.g., organizing a small folder)</option>
                    <option value="High Effort (e.g., preparing a report)">High Effort (e.g., preparing a report)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Task Preference Type:</label><br>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="task_pref_type" value="Digital (emails, files, online research)"> Digital</label>
                    <label><input type="checkbox" name="task_pref_type" value="Physical (tidying, quick errands)"> Physical</label>
                    <label><input type="checkbox" name="task_pref_type" value="Communication (quick calls, messages)"> Communication</label>
                    <label><input type="checkbox" name="task_pref_type" value="Planning (to-do lists, scheduling)"> Planning</label>
                </div>
            </div>
            <div class="form-group">
                <label for="taskQuickWins">Task Preference Quick Wins:</label>
                <select id="taskQuickWins" name="task_pref_quick_wins">
                    <option value="">Select quick wins</option>
                    <option value="Very Quick Wins (under 5 mins)">Very Quick Wins (under 5 mins)</option>
                    <option value="Quick Wins (5-15 mins)">Quick Wins (5-15 mins)</option>
                    <option value="Any quick task will do">Any quick task will do</option>
                </select>
            </div>

            <h2>Break Preferences</h2>
            <div class="form-group">
                <label for="breakRecharge">Break Preference Recharge:</label>
                <select id="breakRecharge" name="break_pref_recharge">
                    <option value="">Select recharge type</option>
                    <option value="Passive (e.g., listening to music, mindful breathing)"> Passive</option>
                    <option value="Active (e.g., stretching, short walk)"> Active</option>
                    <option value="Social (e.g., quick chat, call)"> Social</option>
                </select>
            </div>
            <div class="form-group">
                <label for="breakLocation">Break Preference Location:</label>
                <select id="breakLocation" name="break_pref_location">
                    <option value="">Select location</option>
                    <option value="Indoors (at my desk)"> Indoors (at my desk)</option>
                    <option value="Indoors (away from desk)"> Indoors (away from desk)</option>
                    <option value="Outdoors (e.g., balcony, outside building)"> Outdoors</option>
                </select>
            </div>

            <button type="submit">Save Preferences</button>
        </form>
        <div id="responseMessage"></div>
    </div>

    <script>
        document.getElementById('preferencesForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const form = event.target;
            const formData = new FormData(form);
            const data = {};

            // Collect all form data
           for (let [key, value] of formData.entries()) {
                // Specifically check for known multi-select checkbox names
                if (key === 'meal_pref_cuisine' || key === 'task_pref_type') {
                    if (!data[key]) {
                        data[key] = [];
                    }
                    data[key].push(value);
                } else {
                    // For all other fields (text inputs, single-selects), assign directly
                    data[key] = value;
                }
            }for (let [key, value] of formData.entries()) {
                // Specifically check for known multi-select checkbox names
                if (key === 'meal_pref_cuisine' || key === 'task_pref_type') {
                    if (!data[key]) {
                        data[key] = [];
                    }
                    data[key].push(value);
                } else {
                    // For all other fields (text inputs, single-selects), assign directly
                    data[key] = value;
                }
            }
            // Ensure userId is present, as it's required by FastAPI
            if (!data.user_id) {
                alert("Please enter a User ID.");
                return;
            }

            const responseMessage = document.getElementById('responseMessage');
            responseMessage.className = ''; // Clear previous classes
            responseMessage.textContent = 'Saving preferences...';

            try {
                const response = await fetch('http://localhost:8000/receive_preferences_from_form',  { // <--- This matches your main.py, { // Use your existing endpoint
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    responseMessage.textContent = `Success: ${result.message} for User ID: ${result.user_id}`;
                    responseMessage.classList.add('success');
                    // Optionally, clear the form or redirect
                    // form.reset();
                } else {
                    responseMessage.textContent = `Error: ${result.detail || 'Could not save preferences.'}`;
                    responseMessage.classList.add('error');
                }
            } catch (error) {
                console.error('Network or server error:', error);
                responseMessage.textContent = 'Network error: Could not reach the server. Is your backend running?';
                responseMessage.classList.add('error');
            }
        });
    </script>
</body>
</html>